<html>
<head>
<meta charset="UTF-8"> 
<link href="https://fonts.googleapis.com/css?family=Overpass" rel="stylesheet">
</head>
<body onload="loadIt()">

<h1></h1>
<!--
    CRJ HTML5 EICAS
    Copyright (C) 2018 MDF

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<svg width="480" height="640">
  <rect x="0" y="0" width="480" height="600" fill="black"/>
  <g transform="scale(2.0) translate(-40 -160)">

  <text x="98" y="190" font-family="Overpass" fill="blue" font-size="14px">FLIGHT CONTROLS</text>
  <!--left wing-->
  <path d="m 146,239 2.5,-1.0 0.0,-37 -6,0 -18,12.66 -53.67,27.4 0.0,21.0 19.65,-9.0" stroke="blue" fill="none"/>
  <path d="m 75.88,260.0 -1.9,-4.16 10.3,-4.44 1.98,4.0" stroke="blue" fill="none"/>
  <path d="m 89.86,249.4 23.0,-10.58 31.8,-4.54 0.4,7.8 -27.31,3.59 -24.85,10.58 z" stroke="lightgreen" fill="none"/> 
  
  <!--spoiler-->
  <path d="m 136,221.4 h 8.88 v 6.05 l -8.60,0 z" stroke="lightgreen" fill="none"/>
  <path d="m 124.5,221.4 8.88,0.0 0,6.05 -8.88,0.0 z" stroke="lightgreen" fill="none"/>
  <path d="m 110.7,227.45 8.88,0.0 0.0,6.05 -8.88,0.0 z" stroke="lightgreen" fill="none"/>
  <path d="m 97.6,232.7 h 8.88 v 6.05 l -8.60,0 z"  stroke="lightgreen" fill="none"/>
 

  <!--right-->
  <path d="m 172,239 -2.5,-1.0 0.0,-37 6,0 18,12.66 53.67,27.4 0.0,21.0 -19.65,-9.0" stroke="blue" fill="none"/>

  <path d="m 242,260.0 1.9,-4.16 -10.3,-4.44 -1.98,4.0" stroke="blue" fill="none"/>

  <path d="m 228.134,249.4 -23.0,-10.58 -31.8,-4.54 -0.4,7.8 27.31,3.59 24.85,10.58 z" stroke="lightgreen" fill="none"/> 

  <!--spoiler-->
  <path d="m 173.4,221.4 h 8.88 v 6.05 l -8.60,0 z" stroke="lightgreen" fill="none"/>
  <path d="m 184.9,221.4 8.88,0.0 0,6.05 -8.88,0.0 z" stroke="lightgreen" fill="none"/>
  <path d="m 198.7,227.45 8.88,0.0 0.0,6.05 -8.88,0.0 z" stroke="lightgreen" fill="none"/>
  <path d="m 211.8,232.7 h 8.88 v 6.05 l -8.60,0 z"  stroke="lightgreen" fill="none"/>
  
  <!--tail-->
  <path d="m 159.5,252.2 -39.6,15 0.0,10.7 39.3,-3.6 41.0,3.6 -0.0,-10.7 z" stroke="blue" fill="none"/>
 
  <path d="m 125.20461,277.62871 -0.0945,-5.76413 28.06473,-2.74034 0.0945,5.00819" stroke="blue" fill="none"/>
 
  <path d="m 167.06547,274.98288 -0.0945,-5.57514 28.06473,2.83483 0.28349,5.57514" stroke="blue" fill="none"/>


  <g id="left aileron">
  <path d="m 80,197.40 4,0.0 0.0,26.7 h -4.00" stroke="white" fill="none"/>
  <path d="m 84,209.40 -4.0,1.5 4.0,1.5 z" stroke="white" fill="white"/>
  <path id="left ail caret" d="m 72.5,208.5 5.0,2.5 -5.0,2.5 z" stroke="white" fill="none"/>
  <text id="left flap pos" x="115" y="244" font-family="Overpass" fill="lightgreen" font-size="5px">20</text>

  <text x="72" y="232" font-family="Overpass" fill="white" font-size="5px">AIL</text>
  </g>

  
  <g id="right aileron">
  <path d="m 238,197.40 -4,0.0 0.0,26.7 h 4.00" stroke="white" fill="none"/>
  <path d="m 234,209.40 4.0,1.5 -4.0,1.5 z" stroke="white" fill="white"/>
  <path id="right ail caret" d="m 245,208 -5.0,2.5 5.0,2.5 z" stroke="white" fill="none"/>
  <text id="right flap pos" x="199" y="244" font-family="Overpass" fill="lightgreen" font-size="5px">20</text>
  <text x="240" y="232" font-family="Overpass" fill="white" font-size="5px">AIL</text>
  </g>
  
  <g id="left spoilers">
  <path d="m 98,206.9 9,0.0"      stroke="white" fill="none"/>
  <path d="m 111.0,202 9,0.0"     stroke="white" fill="none"/>
  <path d="m 124,195 9,0.0"       stroke="white" fill="none"/>
  <path d="m 136,195 h 9"         stroke="white" fill="none"/>
  </g>
  
  <g id="right spoilers">
  <path d="m 212.2,206.9 9,0.0"   stroke="white" fill="none"/>
  <path d="m 199.125,202 9,0.0"   stroke="white" fill="none"/>
  <path d="m 185,195 9,0.0"       stroke="white" fill="none"/>
  <path d="m 173,195 h 9"         stroke="white" fill="none"/>
  </g>

  <g id="left elevator">
  <path d="m 108,260 4,0.0 0.0,27 -4,0" stroke="white" fill="none"/>
  <path d="m 112,272 -4.0,1.5 4.0,1.5 z" stroke="white" fill="white"/>
  <path id="left elev caret" d="m 101.5,271 5.0,2.5 -5.0,2.5 z" stroke="white" fill="none"/>
  <text x="101" y="292" font-family="Overpass" fill="white" font-size="5px">ELEV</text>
  </g>

  <g id="right elevator">
  <path d="m 210,260 -4,0.0 0.0,27 4,0.0" stroke="white" fill="none"/>
  <path d="m 206,272 4.0,1.5 -4.0,1.5 z" stroke="white" fill="white"/>
  <path id="right elev caret" d="m 216.5,271 -5.0,2.5 5.0,2.5 z" stroke="white" fill="none"/>
  <text x="205" y="292" font-family="Overpass" fill="white" font-size="5px">ELEV</text>
  </g>

  <g id="rudder">
  <path d="m 135.4,289.2 0.0,-3.6 h 50 l 0.0,3.6" stroke="white" fill="none"/>
  <path d="m 159.1,285.7 1.32,3.4 1.32,-3.4 z" stroke="white" fill="white"/>
  <path id="rudder caret" d="m 158,294.5 2.5,-4.3 2.5,4.3 z" stroke="white" fill="none"/>
  <text x="151" y="283" font-family="Overpass" fill="white" font-size="5px">RUDDER</text>
  </g>


  
  <text x="116" y="306" font-family="Overpass" fill="white" font-size="5px">TRIM</text>

  <g id="aileron trim">


  <text x="97" y="312" font-family="Overpass" fill="white" font-size="5px">AIL</text>

  <text x="84" y="354" font-family="Overpass" fill="white" font-size="5px">LWD</text>
  <text x="104" y="354" font-family="Overpass" fill="white" font-size="5px">RWD</text> 
  
  <path id="leftroll" d="m 89.769343,314.38691 -7.181546,6.80357 -2.36235,11.2448 2.456844,9.44938 7.843006,7.46503" stroke="white" fill="none"/>
  
  <path d="m 89.769343,314.38691 -7.181546,6.80357 -2.36235,11.2448 2.456844,9.44938 7.843006,7.46503" display="none" stroke="white" fill="none"/>
  
  <path id="rightroll" d="m 110.18006,314.48139 7.37053,7.9375 2.26786,9.92188 -1.88988,9.82739 -6.14211,7.84299" stroke="white" fill="none"/>
  
  <path id="rolltrim" d="m 116,332 -31,0" stroke="lightgreen" fill="none"/>

  <circle cx="100.33" cy="332" r="1.0px" stroke="white" stroke-width="0.0px" fill="white"/>
  </g>

  <g id="stab trim">

  <text x="140" y="312" font-family="Overpass" fill="white" font-size="5px">STAB</text>
  <text x="129" y="314" font-family="Overpass" fill="white" font-size="5px">NU</text>
  <text x="129" y="354" font-family="Overpass" fill="white" font-size="5px">ND</text>
 
  <path d="m 139.73,313.63 h -3 l 0,12.38 3,0.0" stroke="white" fill="none"/>
  <path d="m 136.73,326.2 0,18.0" stroke="lightgreen" fill="none"/>

  <path d="m 136.73,344.15 0,6.04761 h 2.92932 " stroke="white" fill="none"/>
  <path d="m 136.73,337.35 2.78758,0" stroke="white" fill="none"/>

  <g id="stabtrim">
  <path id="stabbox" d="m 136.73,333.85 3.44903,0 1.70089,-3.16555 9.92188,0 0,6.52007 -9.78013,0 -1.98438,-3.02382" stroke="lightgreen" fill="none"/>
  <text id="stabtrimnumber" x="142" y="336" font-family="Overpass" fill="lightgreen" font-size="6px">8.3</text>

  </g>

  <circle cx="100.33" cy="332" r="1.0px" stroke="white" stroke-width="0.0px" fill="white"/>
  </g>

  <g id="rudder trim">

  <path d="m 116.32,381.76 5.57516,7.65402 12.00073,3.87427 10.29985,-3.49628 6.52009,-7.18156" stroke="white" fill="none" display="none"/>
  <path id="rudderarc" d="m 116.3221,381.76115 5.57516,7.65402 12.00073,3.87427 10.29985,-3.49628 6.52009,-7.18156" stroke="white" fill="none"/>


  <path id="ruddertrim" d="m 133.33,371.8 0.0,21.54" stroke="lightgreen" fill="none"/>

  <circle cx="133.33" cy="371.8" r="1.0px" stroke="white" stroke-width="0.0px" fill="white"/>

  <text x="124" y="367" font-family="Overpass" fill="white" font-size="5px">RUDDER</text>
  <text x="110" y="380" font-family="Overpass" fill="white" font-size="5px">NL</text>
  <text x="150" y="380" font-family="Overpass" fill="white" font-size="5px">NR</text>
  </g>

  <g id="left spoileron">
  <path id="l_spoileron" d="m 102,233 0,-25" stroke="white" fill="none"/>
  <path id="l_spoileron_arrow" d="m 102.0,207.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  <g id="left flight spoiler">
  <path id="l_flt_spoiler" d="m 115.5,227 0,-25" stroke="white" fill="none"/>
  <path id="l_flt_spoiler_arrow" d="m 115.5,202.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  <g id="left outbd ground spoiler">
  <path id="l_outbd_grd_spoiler" d="m 129,221 0,-25" stroke="white" fill="none"/>
  <path id="l_outbd_grd_spoiler_arrow" d="m 129,195.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  <g id="left inbd ground spoiler">
  <path id="l_inbd_grd_spoiler" d="m 140.5,221 0,-25" stroke="white" fill="none"/>
  <path id="l_inbd_grd_spoiler_arrow" d="m 140.5,195.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>
  <g id="right inbd ground spoiler"> 
  <path id="r_inbd_grd_spoiler" d="m 177.5,221 0,-25" stroke="white" fill="none"/>
  <path id="r_inbd_grd_spoiler_arrow" d="m 177.5,195.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  <g id="right outbd ground spoiler">
  <path id="r_outbd_grd_spoiler" d="m 189.5,221 0,-25" stroke="white" fill="none"/>
  <path id="r_outbd_grd_spoiler_arrow" d="m 189.5,195.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  <g id="right flight spoiler">
  <path id="r_flt_spoiler" d="m 203.5,227 0,-25" stroke="white" fill="none"/>
  <path id="r_flt_spoiler_arrow" d="m 203.5,202.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  <g id="right spoileron">
  <path id="r_spoileron" d="m 216.5,233 0,-25" stroke="white" fill="none"/>
  <path id="r_spoileron_arrow" d="m 216.5,207.5 -2.75,2 m 5.5,0.0 -2.75,-2" stroke="white" fill="none"/>
  </g>

  </g>


  
</svg>


<script>
"use strict";

function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
  var angleInRadians = (angleInDegrees-90) * Math.PI / 180.0;

  return {
    x: centerX + (radius * Math.cos(angleInRadians)),
    y: centerY + (radius * Math.sin(angleInRadians))
  };
}

function describeArc(x, y, radius, startAngle, endAngle){

    var start = polarToCartesian(x, y, radius, endAngle);
    var end = polarToCartesian(x, y, radius, startAngle);

    var largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

    var d = [
        "M", start.x, start.y, 
        "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y
    ].join(" ");

    return d;       
}

var TimerId;

function loadIt() {
  document.getElementById("rightroll").setAttribute("d", describeArc(100.33, 332, 20, 30, 150));

  document.getElementById("leftroll").setAttribute("d", describeArc(100.33, 332, 20, 210, 330));

  document.getElementById("rudderarc").setAttribute("d", describeArc(133.33, 371.8, 22, 120, 240));

  TimerId = setInterval(moveIt,60);

}

function moveSpoilers(spoiler=0,record){
  //0 down
  //1 up all the way

  console.log(spoiler)
  
  let name = record.name;
  let d = record.d;

  if(spoiler>1.0) spoiler=1.0;

  if(spoiler<0.01) {


    document.getElementById(name).setAttribute("display", "none");
  
    document.getElementById(name+"_arrow").setAttribute("display", "none"); 
   
  }
  else if(spoiler<=1.0){
    
d = d + (-25*spoiler);
    let t = 25-25 * spoiler;
    let xlate = "translate(0,"+t+")";

    document.getElementById(name).setAttribute("display", "all");
    document.getElementById(name+"_arrow").setAttribute("display", "all");


    document.getElementById(name).setAttribute("d", d);
    document.getElementById(name+"_arrow").setAttribute("transform", xlate); 
  }

}

function setrolltrim(angle) {
    angle = angle * 6;
    
    let r = "rotate(" + angle + ",100,332)";

    document.getElementById("rolltrim").setAttribute("transform", r);

}

function setruddertrim(angle) {
    angle = angle * -6;
    
    let r = "rotate(" + angle + ",133.33,371.8)";

    document.getElementById("ruddertrim").setAttribute("transform", r);

}

function setelevpos(left0,right0) {

  document.getElementById("left elev caret").setAttribute("transform", "translate(0,"+(left0)+")");
  
  document.getElementById("right elev caret").setAttribute("transform", "translate(0,"+(right0)+")");


}


function setailpos(left0,right0) {

  document.getElementById("left ail caret").setAttribute("transform", "translate(0,"+(-left0)+")");
  
  document.getElementById("right ail caret").setAttribute("transform", "translate(0,"+(-right0)+")");


}

function setrudderpos(rud) {
  
  if(rud!=undefined) {
    rud = rud*2;
    document.getElementById("rudder caret").setAttribute("transform", "translate("+rud+",0)");
  }
  
}

function setstabtrim(pos) {
  //first convert from xp to crj
  
  let v = (0.7)*pos+7.0;
  
  //now, convert to instrument coord
  // xlate 3.5 = 6.3 crj
  // xlate -8  = 8.4 crj
  
  let d = (-11.5)*(v-6.3)/2.1 + 3.5;
  
  //let d = 8
  //let v=d;
  
  let s;
  document.getElementById("stabtrim").setAttribute("transform", "translate(0,"+(d)+")");
  
  if(v>=6.3 && v<=8.4) {
    document.getElementById("stabtrimnumber").setAttribute("fill", "lightgreen");
    document.getElementById("stabbox").setAttribute("stroke", "lightgreen");
  }
  else {
    document.getElementById("stabtrimnumber").setAttribute("fill", "white");
    document.getElementById("stabbox").setAttribute("stroke", "white");
  }
  //convert number to string with only one decimal place.
  if(v<1.0)
     s = v.toPrecision(1);
  else if(v<10.0)
     s = v.toPrecision(2);
  else
     s = v.toPrecision(3);

  document.getElementById("stabtrimnumber").innerHTML = s;
}

//convert flap percentage to flap angle
//for CRJ-200
function adjustflap(flap) {
  let r;
  if(flap>100) flap=100;

  if (flap<=10) {
    r = flap*(8.0/10.0);
  }
  else if(flap<=20) {
    r = (flap-10)*(10.0/10.0) + 10.0;
  }
  else if(flap<=30) {
    r = (flap-20)*(10.0/10.0) + 20.0;
  }
  else if(flap<=40) {
    r = (flap-30)*(15.0/10.0) + 30.0;
  }
  
  return r;

}
function setflappos(left,right) {
  
  //left = left * 2.5;
  //right = right * 2.5;
  
  left = adjustflap(left);
  right = adjustflap(right);
  document.getElementById("left flap pos").innerHTML = Math.round(left);
  document.getElementById("right flap pos").innerHTML = Math.round(right);

}

let phase = 0;
let elev = 0;
let ailtrim = 0;
let s = 0.0;
let spoilers = [{name:'l_spoileron',d:'m 102,233 0,'},
                {name:'l_flt_spoiler',d:'m 115.5,227 0,'},
                {name:'l_outbd_grd_spoiler',d:'m 129,221 0,'}, 
                {name:'l_inbd_grd_spoiler',d: 'm 140.5,221 0,'},
                {name:'r_inbd_grd_spoiler',d: 'm 177.5,221 0,'},
                {name:'r_outbd_grd_spoiler',d: 'm 189.5,221 0,'},
                {name:'r_flt_spoiler',d: 'm 203.5,227 0,'},
                {name:'r_spoileron',  d: 'm 216.5,233 0,'}
                ]

function setspoilersAll(pos){

  for(let sp of spoilers) { 
     moveSpoilers(pos,sp);
  }

}

function moveIt() {

    if(phase==0){
        elev=elev+2;
        if(elev>10) phase=1;
    }
    if(phase==1){
       elev=elev-2;
       if(elev<-10) phase=2;
    }
    if(phase==2){
      elev=elev+1;
      if(elev==0) phase=3;
    }
   
   if(phase<3) {
   for(let sp of spoilers) { 

     moveSpoilers(s,sp);
   }
   s=s+0.02; 
   }

  if(phase==0) ailtrim = ailtrim+2;
  else if(phase==1) ailtrim = ailtrim-2;

  if(phase<2) {
  setelevpos(elev,elev);
  setrolltrim(ailtrim);
  setruddertrim(ailtrim);
  setstabtrim(elev);
  setailpos(elev,-elev);
  setrudderpos(elev);
  
  setstabtrim(0);
  
  }

  if(phase==3) clearInterval(TimerId);

}

</script>
<script src="web.js">

</script>

<div id="output"></div>

<form name="myform">
<p>
<textarea name="outputtext" rows="5" cols="50"></textarea>
</p>
<p>
<textarea name="inputtext" rows="5" cols="50"></textarea>
</p>
<p>
<textarea name="url" cols="50"></textarea>
</p>
<p>
<input type="button" name=sendButton value="Send" onClick="sendText();">
<input type="button" name=clearButton value="Clear" onClick="clearText();">
<input type="button" name=disconnectButton value="Disconnect" onClick="doDisconnect();">
<input type="button" name=connectButton value="Connect" onClick="doConnect();">
</p>


</form>
</body>
</html> 